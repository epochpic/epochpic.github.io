<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="The control block contains information about the general code setup. See EPOCH input deck for more information on the input deck.
Basics The block sets up the basic code properties for the domain, the end time of the code, the load balancer and the types of initial conditions to use."><link rel=alternate hreflang=en-us href=/documentation/input_deck/input_deck_control.html><meta name=theme-color content="#3f51b5"><script src=/js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/academic.css><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hucf2a1ead28adac6bbe3177e5d4e4a1f0_753_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hucf2a1ead28adac6bbe3177e5d4e4a1f0_753_192x192_fill_lanczos_center_2.png><link rel=canonical href=/documentation/input_deck/input_deck_control.html><meta property="twitter:card" content="summary"><meta property="og:site_name" content="EPOCH"><meta property="og:url" content="/documentation/input_deck/input_deck_control.html"><meta property="og:title" content="Control block | EPOCH"><meta property="og:description" content="The control block contains information about the general code setup. See EPOCH input deck for more information on the input deck.
Basics The block sets up the basic code properties for the domain, the end time of the code, the load balancer and the types of initial conditions to use."><meta property="og:image" content="/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_300x300_fit_lanczos_2.png"><meta property="twitter:image" content="/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_300x300_fit_lanczos_2.png"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2024-10-03T15:56:32+01:00"><title>Control block | EPOCH</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_0x70_resize_lanczos_2.png alt=EPOCH></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_0x70_resize_lanczos_2.png alt=EPOCH></a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/quickstart.html><span>Quick Start</span></a></li><li class=nav-item><a class=nav-link href=/documentation.html><span>User Guide</span></a></li><li class=nav-item><a class=nav-link href=/developer.html><span>Dev Guide</span></a></li><li class=nav-item><a class=nav-link href=/publication.html><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/license.html><span>License</span></a></li><li class=nav-item><a class=nav-link href=/contact.html><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-3" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation">
<span><i class="fas fa-bars"></i></span></button>
<input name=q type=search class=form-control placeholder=Search... autocomplete=off></form><nav class="collapse docs-links" id=docs-nav><div class=docs-toc-item><a class=docs-toc-link href=/documentation.html>Overview</a></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/basic_usage.html>Basic usage</a><ul class="nav docs-sidenav"><li><a href=/documentation/basic_usage/faq.html>FAQs</a></li><li><a href=/documentation/basic_usage/structure.html>Structure</a></li><li><a href=/documentation/basic_usage/compiling.html>Compiling</a></li><li><a href=/documentation/basic_usage/compiler_flags.html>Compiler Flags</a></li><li><a href=/documentation/basic_usage/running.html>Running</a></li><li><a href=/documentation/basic_usage/acknowledging_epoch.html>Acknowledging EPOCH</a></li><li><a href=/documentation/basic_usage/libraries.html>Libraries</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/input_deck/input_deck.html>Input deck</a><ul class="nav docs-sidenav"><li><a href=/documentation/input_deck/input_deck_antenna.html>Antenna block</a></li><li><a href=/documentation/input_deck/input_deck_boundaries.html>Boundaries block</a></li><li><a href=/documentation/input_deck/input_deck_bremsstrahlung.html>Bremsstrahlung block</a></li><li><a href=/documentation/input_deck/input_deck_collisions.html>Collisions block</a></li><li><a href=/documentation/input_deck/input_deck_constant.html>Constant block</a></li><li class=active><a href=/documentation/input_deck/input_deck_control.html>Control block</a></li><li><a href=/documentation/input_deck/input_deck_dist_fn.html>Dist_fn block</a></li><li><a href=/documentation/input_deck/input_deck_fields.html>Fields block</a></li><li><a href=/documentation/input_deck/input_deck_injector.html>Injector block</a></li><li><a href=/documentation/input_deck/input_deck_laser.html>Laser block</a></li><li><a href=/documentation/input_deck/input_deck_output_block.html>Output block</a></li><li><a href=/documentation/input_deck/input_deck_output_global.html>Output_global block</a></li><li><a href=/documentation/input_deck/input_deck_particle_file.html>Particles_from_file block</a></li><li><a href=/documentation/input_deck/input_deck_probe.html>Probe block</a></li><li><a href=/documentation/input_deck/input_deck_qed.html>QED block</a></li><li><a href=/documentation/input_deck/input_deck_species.html>Species block</a></li><li><a href=/documentation/input_deck/input_deck_subset.html>Subset block</a></li><li><a href=/documentation/input_deck/input_deck_window.html>Window block</a></li><li><a href=/documentation/input_deck/binary_files.html>Binary files</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/code_details.html>Code details</a><ul class="nav docs-sidenav"><li><a href=/documentation/code_details/maths_parser.html>Maths parser</a></li><li><a href=/documentation/code_details/using_epoch_in_practice.html>Using EPOCH in practice</a></li><li><a href=/documentation/code_details/using_delta_f.html>Using delta f</a></li><li><a href=/documentation/code_details/previous_versions.html>Previous versions</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/visualising_output.html>Visualising output</a><ul class="nav docs-sidenav"><li><a href=/documentation/visualising_output/visualising_sdf_files_with_idl_or_gdl.html>IDL or GDL</a></li><li><a href=/documentation/visualising_output/visualising_sdf_files_with_llnl_visit.html>LLNL VisIt</a></li><li><a href=/documentation/visualising_output/python_beam.html>Python BEAM</a></li><li><a href=/documentation/visualising_output/python_sdf_helper.html>Python sdf_helper</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/examples.html>Examples</a><ul class="nav docs-sidenav"><li><a href=/documentation/examples/basic_examples.html>Basic examples</a></li><li><a href=/documentation/examples/workshop_examples.html>Workshop examples</a></li><li><a href=/documentation/examples/workshop_examples_continued.html>Workshop examples continued</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><article class=article><div class=docs-article-container><h1>Control block</h1><div class=article-style><p>The <em>control</em> block contains information about the general code setup.
See
<a href=/documentation/input_deck/input_deck>EPOCH input deck</a> for more information
on the input deck.</p><h1 id=basics>Basics</h1><p>The block sets up the basic code properties for the domain, the end time
of the code, the load balancer and the types of initial conditions to
use.</p><p>The control block of a valid input deck for EPOCH2D reads as follows:</p><pre><code class=language-perl>begin:control
   # Global number of gridpoints
   nx = 512 # in x
   ny = 512 # in y
   # Global number of particles
   npart = 10 * nx * ny

   # Final time of simulation
   t_end = 1.0e-12
   # nsteps = -1

   # Size of domain
   x_min = -0.1e-6
   x_max = 400.0e-6
   y_min = -400.0e-6
   y_max = 400.0e-6

   # dt_multiplier = 0.95
   # dlb_threshold = 0.8

   # restart_snapshot = 98

   # field_order = 2
   # maxwell_solver = yee
   # stdout_frequency = 10
end:control
</code></pre><p>As illustrated in the above code block, the &ldquo;<code>#</code>&rdquo; symbol is
treated as a comment character and the code ignores everything on a line
following this character.
The allowed entries are as follows:</p><ul><li><p><code>nx, ny, nz</code> - Number of grid points in the x,y,z
direction. This parameter is mandatory.</p></li><li><p><code>npart</code> - The global number of pseudoparticles in the
simulation. This parameter does not need to be given if a specific
number of particles is supplied for each particle species by using the
&ldquo;npart&rdquo; directive in each
<a href=/documentation/input_deck/input_deck_species><strong>species</strong> block</a>.
If both are given then the
value in the <strong>control</strong> block will be ignored.</p></li><li><p><code>nsteps</code> - The number of iterations of the core solver
before the code terminates. Negative numbers instruct the code to only
terminate at <strong>t_end</strong>. If <strong>nsteps</strong> is not specified then <strong>t_end</strong>
must be given.</p></li><li><p><code>t_end</code> - The final simulation time in simulation seconds
before the code terminates. If <strong>t_end</strong> is not specified then
<strong>nsteps</strong> must be given. If they are both specified then the first time
restriction to be satisfied takes precedence. Sometimes it is more
useful to specify the time in picoseconds or femtoseconds. To accomplish
this, just append the appropriate multiplication factor. For example,
&ldquo;t_end = 3 * femto&rdquo; specifies 3 femtoseconds. A list of multiplication
factors is supplied
<a href=/documentation/code_details/maths_parser#constants>here</a>.</p></li><li><p><code>{x,y,z}_min</code> - Minimum grid position of the domain in
metres. These are required parameters. Can be negative. &ldquo;{x,y,z}_start&rdquo;
is accepted as a synonym. In a similar manner to that described above,
distances can be specified in microns using a multiplication constant.
eg. &ldquo;x_min = 4 * micron&rdquo; specifies a distance of 4 μm.</p></li><li><p><code>{x,y,z}_max</code> - Maximum grid position of the domain in
metres. These are required parameters. Must be greater than
<em>{x,y,z}_min</em>. &ldquo;{x,y,z}_end&rdquo; is accepted as a synonym.</p></li><li><p><code>dt_multiplier</code> - Factor by which the timestep is
multiplied before it is applied in the code, i.e. a multiplying factor
applied to the CFL condition on the timestep. Must be less than one. If
no value is given then the default of 0.95 is used. If maxwell_solver
is different from &ldquo;yee&rdquo; (the default) this parameter becomes
increasingly relevant.</p></li><li><p><code>dlb_threshold</code> - The minimum ratio of the load on the
least loaded processor to that on the most loaded processor allowed
before the code load balances. Set to 1 means always balance, set to 0
means never balance. If this parameter is not specified then the code
will only be load balanced at initialisation time.</p></li><li><p><code>restart_snapshot</code> - The number of a previously written
restart dump to restart the code from. If not specified then the initial
conditions from the input deck are used.
Note that as of version 4.2.5, this parameter can now also accept a
filename in place of a number. If you want to restart from &ldquo;0012.sdf&rdquo;
then it can either be specified using &ldquo;restart_snapshot = 12&rdquo;, or
alternatively it can be specified using &ldquo;restart_snapshot = 0012.sdf&rdquo;.
This syntax is required if output file prefixes have been used (see the
<a href=/documentation/input_deck/input_deck_output_block>output block</a> page).</p></li><li><p><code>field_order</code> - Order of the finite difference scheme used
for solving Maxwell&rsquo;s equations. Can be 2, 4 or 6. If not specified, the
default is to use a second order scheme.</p></li><li><p><code>maxwell_solver</code> - Choose a Maxwell solver scheme with an extended stencil. This option
is only active if field_order is set to 2. Possible options are &ldquo;yee&rdquo;,
&ldquo;lehe_{x,y,z}&rdquo;, &ldquo;pukhov&rdquo;, &ldquo;cowan&rdquo; and since v4.12 &ldquo;custom&rdquo;. Note that
not all options are available in 1d and 2d. The default is &ldquo;yee&rdquo; which
is the default second order scheme.</p></li><li><p><code>stdout_frequency</code> - If specified then the code will print
a one line status message to stdout after every given number or
timesteps. The default is to print nothing to screen (i.e.
<strong>stdout_frequency = 0</strong>).</p></li><li><p><code>use_random_seed</code> - The initial particle distribution is
generated using a random number generator. By default, EPOCH uses a
fixed value for the random generator seed so that results are
repeatable. If this flag is set to &ldquo;T&rdquo; then the seed will be generated
using the system clock.</p></li><li><p><code>nproc{x,y,z}</code> - Number of processes in the <em>x,y,z</em>
directions (e.g. <code>nprocx = 4</code>). By default, EPOCH will try to pick the best method of
splitting the domain amongst the available processors but occasionally
the user may wish to override this choice.</p></li><li><p><code>smooth_currents</code> - This is a logical flag. If set to &ldquo;T&rdquo;
then a smoothing function is applied to the current generated during the
particle push. This can help to reduce noise and self-heating in a
simulation. The smoothing function used is the same as that outlined in
Buneman <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. The default value is &ldquo;F&rdquo;.</p></li><li><p><code>field_ionisation</code> - Logical flag which turns on field
ionisation. See
<a href=/documentation/input_deck/input_deck_species.html#ionisation>here</a>.</p></li><li><p><code>physics_table_location</code> - EPOCH expects you to run the code from the
<code>epoch1d</code>, <code>epoch2d</code> or <code>epoch3d</code> directories, so all paths are relative to
this. If you can&rsquo;t run the code from here, you must manually specify the
location of the TABLES file by setting this key to something like:
<code>"/absolute/path/to/epoch/epoch2d/src/physics_packages/TABLES"</code></p></li><li><p><code>use_bsi</code> - Logical flag which turns on barrier
suppression ionisation correction to the tunnelling ionisation model for
high intensity lasers. See
<a href=/documentation/input_deck/input_deck_species.html#ionisation>here</a> . This flag
should always be enabled when using field ionisation and is only
supplied for testing purposes. The default is &ldquo;T&rdquo;.</p></li><li><p><code>use_multiphoton</code> - Logical flag which turns on modelling
ionisation by multiple photon absorption. This should be set to &ldquo;F&rdquo; if
there is no laser attached to a boundary as it relies on laser
frequency. See
<a href=/documentation/input_deck/input_deck_species.html#ionisation>here</a>.
This flag should always be enabled when using field ionisation and is
only supplied for testing purposes. The default is &ldquo;T&rdquo;.</p></li><li><p><code>particle_tstart</code> - Specifies the time at which to start
pushing particles. This allows the field to evolve using the Maxwell
solver for a specified time before beginning to move the particles.</p></li><li><p><code>use_exact_restart</code> - Logical flag which makes a
simulation restart as close as is numerically possible to if the
simulation had not been stopped and restarted. Without this flag set to
T then the simulation will still give a correct result after restart, it
is simply not guaranteed to be identical to if the code had not been
restarted. This flag is mainly intended for testing purposes and is not
normally needed for physical simulations. If set to &ldquo;T&rdquo; then the domain
split amongst processors will be identical along with the seeds for the
random number generators. Note that the flag will be ignored if the
number of processors does not match that used in the original run. The
default value is &ldquo;F&rdquo;.</p></li><li><p><code>use_current_correction</code> - Logical flag to specify
whether EPOCH should correct for residual DC current in the initial
conditions. If set to true, the DC current in the initial conditions is
calculated and is subtracted from all subsequent current depositions.</p></li><li><p><code>allow_cpu_reduce</code> - Logical flag which allows the
number of CPUs used to be reduced from the number specified. In some
situations it may not be possible to divide the simulation amongst
all the processors requested. If this flag is set to &ldquo;T&rdquo; then EPOCH
will continue to run and leave some of the requested CPUs idle. If
set to &ldquo;F&rdquo; then code will exit if all CPUs cannot be utilised. The
default value is &ldquo;T&rdquo;.</p></li><li><p><code>check_stop_file_frequency</code> - Integer parameter
controlling automatic halting of the code. The frequency is
specified as number of simulation cycles. Refer to description later
in this section. The default value is 10.</p></li><li><p><code>stop_at_walltime</code> - Floating point parameter
controlling automatic halting of the code. Refer to description
later in this section. The default value is -1.0.</p></li><li><p><code>stop_at_walltime_file</code> - String parameter controlling
automatic halting of the code. See
<a href=#automatic_halting_of_a_simulation>below</a>. The default
value is an empty string.</p></li><li><p><code>simplify_deck</code> - If this logical flag is set to &ldquo;T&rdquo;
then the deck parser will attempt to simplify the maths expressions
encountered after the first pass. This can significantly improve the
speed of evaluation for some input deck blocks. The default value is
&ldquo;F&rdquo;.</p></li><li><p><code>print_constants</code> - If this logical flag is set to &ldquo;T&rdquo;,
deck constants are printed to the &ldquo;deck.status&rdquo; (and
&ldquo;const.status&rdquo; after 4.11) file as they are parsed. The default
value is &ldquo;F&rdquo;.</p></li><li><p><code>use_migration</code> - Logical flag which determines whether
or not to use
<a href=/documentation/input_deck/input_deck_species#particle_migration_between_species>particle migration</a>.
The default is &ldquo;F&rdquo;.</p></li><li><p><code>migration_interval</code> - The number of timesteps between
each
<a href=/documentation/input_deck/input_deck_species#particle_migration_between_species>migration event</a>.
The default is 1 (migrate at every timestep).</p></li><li><p><code>allow_missing_restart</code> - Logical flag to allow code to
run when a restart dump is absent. When &ldquo;restart_snapshot&rdquo; is
specified then the simulation first checks that the specified
restart dump is valid. If the restart dump exists and is valid then
it is used to provide initial conditions for the simulation.
However, if the restart dump does not exist or is not usable for
some reason then by default the simulation will abort. If
&ldquo;allow_missing_restart&rdquo; is set to &ldquo;T&rdquo; then the simulation will
not abort but will continue to run and use the initial conditions
contained in the input deck to initialise the simulation. The
default value is &ldquo;F&rdquo;.</p></li><li><p><code>print_eta_string</code> - If this logical flag is set to
&ldquo;T&rdquo; then the current estimated time to completion will be appended
to the status updates. The default value is &ldquo;T&rdquo;.</p></li><li><p><code>n_zeros</code> - Integer flag which specifies the number of
digits to use for the output file numbers. (eg. &ldquo;0012.sdf&rdquo;). By
default, the code tries to calculate the number of digits required
by dividing t_end by dt_snapshot. Note that the minimum number of
digits is 4.</p></li><li><p><code>use_accurate_n_zeros</code> - If this logical flag is set to &ldquo;T&rdquo; then the
code performs a more
rigorous test to determine the number of digits required to accommodate
all outputs that are to be generated by a run. Since this can be time
consuming and is overkill for most cases, it is disabled by default. The
default value is &ldquo;F&rdquo;.</p></li><li><p><code>use_particle_count_update</code> - If this logical flag is set to &ldquo;T&rdquo; then the code
keeps global particle counts for each species on each processor. This
information isn&rsquo;t needed by the core algorithm, but can be useful for
developing some types of additional physics packages. It does require
one additional MPI_ALL_REDUCE per species per timestep, so it is not
activated by default. The default value is &ldquo;F&rdquo;.</p></li><li><p><code>reset_walltime</code> - When restarting from a
dump file, the current walltime displayed will include the elapsed
walltime recorded in the restart dump. The user can request that this
time is ignored by setting the &ldquo;reset_walltime&rdquo; flag to &ldquo;T&rdquo;. The
default value is &ldquo;F&rdquo;.</p></li><li><p><code>dlb_maximum_interval</code> - This integer parameter determines the maximum
number of timesteps to allow between load balancing checks. Each time
that the load balancing sweep is unable to improve the load balance of
the simulation, it doubles the number of steps before the next check
will occur. It will keep increasing the check interval until it reaches
the value given by <strong>dlb_maximum_interval</strong>. If the value of
<strong>dlb_maximum_interval</strong> is negative then the check interval will
increase indefinitely. When the load balancing sweep finds an
improvement to the load balance of the simulation, the check interval is
reset to one. The default value is 500.</p></li><li><p><code>dlb_force_interval</code> - This integer parameter determines the maximum number of timesteps to
allow between forcing a full load balance sweep. If the current load
balance is greater than the value of <strong>dlb_threshold</strong> then the load
balancer exits before attempting to improve the loading. If
<strong>dlb_force_interval</strong> is greater than zero, then the full load
balancer will be run at the requested interval of timesteps, regardless
of the value of <strong>dlb_threshold</strong>. Note that the simulation will only
be redistributed if this would result in an improved load balance. The
default value is 2000.</p></li><li><p><code>balance_first</code> - This logical flag determines whether a load balance will be attempted
on the first call of the load balancer. The load balancer performs to
functions: first it attempts to find a domain decomposition that
balances the load evenly amongst processors. Next, it redistributes the
domain and particles onto the new layout (if requred). This latter step
is always required when setting up the simulation, so the load balancer
is always called once during set-up. This flag controls whether or not a
load balance is attempted during this call, regardless of the value of
<strong>dlb_threshold</strong>. The default value is &ldquo;T&rdquo;.</p></li><li><p><code>use_pre_balance</code> - This logical flag determines whether a load balance
will be attempted before the particle load occurs. If this flag is set to
&ldquo;T&rdquo; then the particle auto-loader will be called at setup time, but
instead of creating particles it will just populate a particle-per-cell
field array. This will then be used to calculate the optimal domain
decomposition and all field arrays will be redistributed to use the new
layout. Finally, after all of this has been done, the auto-loader will be
called again and create just the particles that are present on their
optimally load-balanced domains. In contrast, if the flag is set to &ldquo;F&rdquo;
then the domain is just divided evenly amongst processors and the particles
are loaded on this domain decomposition. Balancing is then carried out on
to redistribute the work load. For heavily imbalanced problems, this can
lead to situations in which there is insufficient memory to setup a
simulation, despite there being sufficient resources for the final
load-balanced conditions. The default value is &ldquo;T&rdquo;.</p></li><li><p><code>use_optimal_layout</code> - This logical flag determines whether the load
balancer attempts to find an optimal processor split before loading the
particles. The initial domain split is chosen in such a way as to minimize
the total surface area of the resulting domains in 3D, or edge lengths in
2D. For example, if a 2D square domain is run on 16 CPUs then the domain
will be divided by 4 in the x-direction and 4 in the y-direction. The other
possible splits (1x16, 2x8, 8x2, 16x1) are rejected because they all yield
rectangular subdomains whose total edge length is greater than the 4x4
edge length. For some problems (eg. a density ramp or thin foil) this is a
poor choice and a better load balance would be obtained by a less even
split. It is always possible to specify such a split by using
<strong>nproc{x,y,z}</strong> flags but enabling the <strong>use_optimal_layout</strong> flag will
automatically determine the best split for you. Future versions of the
code will also allow the split to be changed dynamically at run time. The
default value is &ldquo;T&rdquo;.</p></li><li><p><code>use_more_setup_memory</code> - This logical flag determines whether the extra
memory will be used during the initial setup of particle species. If set
to false then only one set of arrays will be used for storing temperature,
density and drift during species loading. This can be a significant memory
saving but omes at the expense of recalculating grid quantities multiple
times. Setting the flag to true enables one set of arrays per species. The
default value is &ldquo;F&rdquo;.</p></li><li><p><code>deck_warnings_fatal</code> - This logical flag controls the behaviour of the
deck parser when a warning is encountered. Usually the code will just
print a warning message and continue running. Setting this flag to &ldquo;T&rdquo;
will force the code to abort. The default value is &ldquo;F&rdquo;.</p></li></ul><h1 id=maxwell_solvers>Maxwell Solvers</h1><p>With the default settings &ldquo;field_order=2&rdquo;, &ldquo;maxwell_solver=yee&rdquo; EPOCH
will use the standard second order Yee scheme for solving Maxwell&rsquo;s
equations. This scheme has a grid dispersion relation with phase
velocities smaller than $c$, especially for large spatial frequencies.
Since EPOCH v4.11 it is possible to introduce extended stencils into the
update step of the Maxwell-Faraday equation which will help improving
the dispersion relation. All of the following extended stencils are only
available when &ldquo;field_order=2&rdquo;. Please note that you will also need to
choose an appropriate dt_multiplier, according to the selected scheme.
A dt_multiplier equal to unity would result in using the largest
time-step allowed by the CFL condition for any of the implemented
schemes. This time-step is said to be marginally stable. While, in
general, the marginally stable time-step has the best dispersion
properties, simulations may suffer from numerical problems such as
exponentially growing noise. Choosing smaller values for the
dt_multiplier tend to improve on this, while adversely affecting the
dispersion relation. The implemented solvers behave differently in this
regard.</p><p>Different options are available as follows:</p><ul><li><p><code>maxwell_solver = lehe_{x,y,z}</code> - This setting will
enable an extended stencil proposed by Lehe et al <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. This stencil
focusses on improving the dispersion relation on the $x$-axis, please
take this into account when defining your laser input. It is available
in EPOCH1D, EPOCH2D and EPOCH3D. While it is not technically required to
use a dt_multiplier smaller than unity, the value proposed by Lehe et
al <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> is &ldquo;dt_multiplier=0.96&rdquo;.</p></li><li><p><code>maxwell_solver = pukhov</code> - This setting will enable an
extended stencil proposed by Pukhov <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> under the name of NDFX. It
is available in EPOCH2D and EPOCH3D. In EPOCH1D, setting
maxwell_solver = pukhov will make the code fall back silently to
Yee&rsquo;s scheme. Pukhov&rsquo;s NDFX scheme aims at improving the numerical
dispersion relation by allowing to choose " dt_multiplier= 1.0",
while smaller values are also valid. The resulting dispersion
relation is best along the axis with the smallest grid spacing.</p></li></ul><ul><li><p><code>maxwell_solver = cowan</code> - This setting will enable en
extended stencil proposed by Cowan et al <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. It is available only
in EPOCH3D. In EPOCH1D and EPOCH2D, setting maxwell_solver = cowan
will make the code fall back silently to Yee&rsquo;s scheme. Cowan et al
<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> proposes to numerically calculate a time step that has the
correct group velocity for the input laser. Typically these time
steps are only slightly below the CFL condition, e.g. " = 0.999".
When Cowan&rsquo;s scheme is reduced to 2D it is the same as Pukhov&rsquo;s
scheme with dt_multiplier &lt;1.0. The resulting dispersion relation
is best along the axis with the smallest grid spacing.</p></li><li><p><code>maxwell_solver = custom</code> - This setting will enable full user control
over the extended stencil coefficients. This allows for the specification
of optimised coefficients as outlined in <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>. This option must be
accompanied by a &ldquo;stencil&rdquo; block. See
<a href=/documentation/input_deck/input_deck_control#stencil_block>below.</a></p></li></ul><h1 id=stencil_block>Stencil Block</h1><p>The extended stencil Maxwell solvers described above all operate by
including points in neighbouring cells with a carefully chosen
weighting. These weightings are determined by adjusting the coefficients
shown in the Figure. Full control over these coefficients can be
achieved by specifying &ldquo;custom&rdquo; for the &ldquo;maxwell_solver&rdquo; parameter in
the control block and then supplying a &ldquo;stencil&rdquo; block to provide the
desired coefficient values.</p><p><img src=Stencil.png alt="Coefficient locations for the B_z field computational stencil in2D.">
This option allows the user to specify an extended stencil scheme that
has been specifically optimised for the simulation grid spacing and
timestep. See <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> for further details.
or see
<a href=https://github.com/Ablinne/optimize-stencil target=_blank rel=noopener>6</a> for stencil
optimization code. Note that there is no option for changing the value
of $\alpha_{x,y,z}$ since these are calculated using the following
equations:
$$
\begin{aligned}
\alpha_x &= 1 - 2\beta_{xy} - 2\beta{xz} - 3\delta_x\,, \\\<br>\alpha_y &= 1 - 2\beta_{yx} - 2\beta{yz} - 3\delta_y\,, \\\<br>\alpha_z &= 1 - 2\beta_{zx} - 2\beta{zy} - 3\delta_z\,.
\end{aligned}
$$</p><ul><li><code>delta{x,y,z}, gamma{x,y,z}, beta{xy,xz,yx,yz,zx,zy}</code> -
The coefficients to use for the extended stencil points as shown in
Figure [stencil]. See for further details. These coefficients are
specified as floating point numbers. The default values are to set
all coefficients to zero which results in $\alpha_{x,y,z}$ having
values of unity. This corresponds to the standard Yee scheme.</li><li><code>dt</code> - The timestep restriction to use for the field
solver</li></ul><h1 id=strided_current_filtering>Strided Current Filtering</h1><p>EPOCH 4.15 introduces strided multipass digital current filtering as
described and benchmarked in the review by
<a href=https://www.sciencedirect.com/science/article/abs/pii/S163107211400148X target=_blank rel=noopener>Vay and
Godfrey</a>.
This can be tuned to substantially damp high frequencies in the currents
and can be used to reduce the effect of numerical Cherenkov radiation.
Once you turn on current filtering by specifying &ldquo;smooth_currents=T&rdquo;
you can then set the following keys</p><ul><li><code>smooth_iterations</code> - Integer number of iterations of
the smoothing function to be performed. If not present defaults to
one iteration. More iterations will produce smoother results but
will be slower.</li><li><code>smooth_compensation</code> - Logical flag. If true then
perform a compensation step (see Vay and Godfrey <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>) after the
smoothing steps are performed. Total number of iterations if true is
smooth_iterations + 1. If not specified defaults to false</li><li><code>smooth_strides</code> - Either a comma separated list of
integers or &ldquo;auto&rdquo; (without quote marks). This specifies the
strides (in number of grid cells) to use when performing strided
filtering. Specifying &ldquo;1, 3&rdquo; will smooth each point with the
points immediately adjacent and with the points 3 cells away on each
side of the current cell. Setting this key to &ldquo;auto&rdquo; uses a &ldquo;1,
2, 3, 4&rdquo; set of strides as a &ldquo;good&rdquo; starting point for strided
filtering.</li></ul><p>It should be stressed that there is no set of values that is guaranteed
to give any given result from filtering while not affecting the physical
correctness of your simulation. Current filtering should be tuned to
match the problem that you want to work on and should always be
carefully tested to ensure that it doesn&rsquo;t produce unphysical results.</p><h1 id=dynamic_load_balancing>Dynamic Load Balancing</h1><p>&ldquo;dlb&rdquo; in the input deck stands for Dynamic Load Balancing and, when
turned on, it allows the code to rearrange the internal domain
boundaries to try and balance the workload on each processor. This
rearrangement is an expensive operation, so it is only performed when
the maximum load imbalance reaches a given critical point. This critical
point is given by the parameter &ldquo;dlb_threshold&rdquo; which is the ratio of
the workload on the least loaded processor to the most loaded processor.
When the calculated load imbalance is less than &ldquo;dlb_threshold&rdquo; the
code performs a re-balancing sweep, so if &ldquo;dlb_threshold = 1.0&rdquo; is set
then the code will keep trying to re-balance the workload at almost
every timestep. At present the workload on each processor is simply
calculated from the number of particles on each processor, but this will
probably change in future. If the &ldquo;dlb_threshold&rdquo; parameter is not
specified then the code will only be load balanced at initialisation
time.</p><h1 id=automatic_halting_of_a_simulation>Automatic halting of a simulation</h1><p>It is sometimes useful to be able to halt an EPOCH simulation midway
through execution and generate a restart dump. Two methods have been
implemented to enable this.</p><p>The first method is to check for the existence of a &ldquo;STOP&rdquo; file.
Throughout execution, EPOCH will check for the existence of a file named
either &ldquo;STOP&rdquo; or &ldquo;STOP_NODUMP&rdquo; in the simulation output directory. The
check is performed at regular intervals and if such a file is found then
the code exits immediately. If &ldquo;STOP&rdquo; is found then a restart dump is
written before exiting. If &ldquo;STOP_NODUMP&rdquo; is found then no I/O is
performed.</p><p>The interval between checks is controlled by the integer parameter
&ldquo;check_stop_frequency&rdquo; which can be specified in the &ldquo;control&rdquo; block
of the input deck. If it is less than or equal to zero then the check is
never performed.</p><p>The next method for automatically halting the code is to stop execution
after a given elapsed walltime. If a positive value for
&ldquo;stop_at_walltime&rdquo; is specified in the control block of an input deck
then the code will halt once this time is exceeded and write a restart
dump. The parameter takes a real argument which is the time in seconds
since the start of the simulation.</p><p>An alternative method of specifying this time is to write it into a
separate text file. &ldquo;stop_at_walltime_file&rdquo; is the filename from
which to read the value for &ldquo;stop_at_walltime&rdquo;. Since the walltime
will often be found by querying the queueing system in a job script, it
may be more convenient to pipe this value into a text file rather than
modifying the input deck.</p><h1 id=requesting_output_dumps_at_run_time>Requesting output dumps at run time</h1><p>In addition to polling for the existence of a &ldquo;STOP&rdquo; file, EPOCH also
periodically checks the output directory for a file named &ldquo;DUMP&rdquo;. If
such a file is found then EPOCH will immediately create an output dump
and remove the &ldquo;DUMP&rdquo; file. By default, the file written will be a
restart dump but if the &ldquo;DUMP&rdquo; file contains the name of an output
block then this will be used instead.</p><h1 id=references>References</h1><p><references></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>O. Buneman, &ldquo;TRISTAN: The 3-D Electromagnetic Particle Code.&rdquo; in
Computer Space Plasma Physics: Simulations Techniques and Software,
1993.
<a href=https://www.terrapub.co.jp/e-library/cspp/ target=_blank rel=noopener>1</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>R. Lehe, A. Lifschitz, C. Thaury, V. Malka, and X. Davoine,
&ldquo;Numerical growth of emittance in simulations of laser-wakefield
acceleration,&rdquo; Phys. Rev. Accel. Beams, vol. 16, no. 2, p.021301,
2013
<a href=https://www.researchgate.net/publication/258097872_Numerical_growth_of_emittance_in_simulations_of_laser-wakefield_acceleration target=_blank rel=noopener>2</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Pukhov, A., &ldquo;Three-dimensional electromagnetic relativistic
particle-in-cell code VLPL (Virtual Laser Plasma Lab)&rdquo;, J. Plasma
Phys., vol. 61, no. 3, p. 425, 1999
<a href=https://www.cambridge.org/core/journals/journal-of-plasma-physics/article/three-dimensional-electromagnetic-relativistic-particle-in-cell-code-vlpl-virtual-laser-plasma-lab/7FBA476D599E2F19DFEA3F0F2F84FFAB target=_blank rel=noopener>3</a>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>B. Cowan, D. Bruhwiler, J. Cary, E. Cormier-Michel, and C. Geddes,
&ldquo;Generalized algorithm for control of numerical dispersion in
explicit time-domain electromagnetic simulations&rdquo;, Phys. Rev.
Accel. Beams, vol. 16, no. 4, p. 041303, 2013
<a href=https://journals.aps.org/prab/abstract/10.1103/PhysRevSTAB.16.041303 target=_blank rel=noopener>4</a>.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>A. Blinne, D. Schinkel, S. Kuschel, N. Elkina, S. G. Rykovanov,
and M. Zepf, &ldquo;A systematic approach to numerical dispersion in
Maxwell solvers&rdquo;, Computer Physics Communications, 00104655,
2017
<a href=https://arxiv.org/pdf/1710.06829.pdf target=_blank rel=noopener>5</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p>J. L. Vay and B. B. Godfrey,
&ldquo;Modeling of relativistic plasmas with the particle-in-cell method&rdquo;,
Comptes Rendus Mcanique, 2014
<a href=http://www.sciencedirect.com/science/article/pii/S163107211400148X target=_blank rel=noopener>6</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/documentation/input_deck/input_deck_bremsstrahlung.html rel=next>Bremsstrahlung block</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=/documentation/input_deck/input_deck_boundaries.html rel=prev>Boundaries block</a></div></div></div></div><div class=body-footer><p>Last updated on Oct 3, 2024</p></div></article><footer class=site-footer><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.</p></footer></main></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script><script>const code_highlighting=!0</script><script>const isSiteThemeDark=!1</script><script>const search_config={indexURI:"/index.json",minLength:1,threshold:.3},i18n={no_results:"No results found",placeholder:"Search...",results:"results found"},content_type={post:"Posts",project:"Projects",publication:"Publications",talk:"Talks"}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.6f1005d1a84220e2f466ff3d8e712f31.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div></body></html>