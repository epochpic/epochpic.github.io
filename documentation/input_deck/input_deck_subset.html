<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="This block contains configuration for filters which can be used to modify the data to be output. See EPOCH input deck for more information on the input deck.
It is possible to restrict the number of particles written to file according to various criteria."><link rel=alternate hreflang=en-us href=/documentation/input_deck/input_deck_subset.html><meta name=theme-color content="#3f51b5"><script src=/js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/academic.css><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hucf2a1ead28adac6bbe3177e5d4e4a1f0_753_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hucf2a1ead28adac6bbe3177e5d4e4a1f0_753_192x192_fill_lanczos_center_2.png><link rel=canonical href=/documentation/input_deck/input_deck_subset.html><meta property="twitter:card" content="summary"><meta property="og:site_name" content="EPOCH"><meta property="og:url" content="/documentation/input_deck/input_deck_subset.html"><meta property="og:title" content="Subset block | EPOCH"><meta property="og:description" content="This block contains configuration for filters which can be used to modify the data to be output. See EPOCH input deck for more information on the input deck.
It is possible to restrict the number of particles written to file according to various criteria."><meta property="og:image" content="/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_300x300_fit_lanczos_2.png"><meta property="twitter:image" content="/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_300x300_fit_lanczos_2.png"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2023-04-06T09:47:55+01:00"><title>Subset block | EPOCH</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_0x70_resize_lanczos_2.png alt=EPOCH></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_0x70_resize_lanczos_2.png alt=EPOCH></a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/quickstart.html><span>Quick Start</span></a></li><li class=nav-item><a class=nav-link href=/documentation.html><span>User Guide</span></a></li><li class=nav-item><a class=nav-link href=/developer.html><span>Dev Guide</span></a></li><li class=nav-item><a class=nav-link href=/publication.html><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/license.html><span>License</span></a></li><li class=nav-item><a class=nav-link href=/contact.html><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-3" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation">
<span><i class="fas fa-bars"></i></span></button>
<input name=q type=search class=form-control placeholder=Search... autocomplete=off></form><nav class="collapse docs-links" id=docs-nav><div class=docs-toc-item><a class=docs-toc-link href=/documentation.html>Overview</a></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/basic_usage.html>Basic usage</a><ul class="nav docs-sidenav"><li><a href=/documentation/basic_usage/faq.html>FAQs</a></li><li><a href=/documentation/basic_usage/structure.html>Structure</a></li><li><a href=/documentation/basic_usage/compiling.html>Compiling</a></li><li><a href=/documentation/basic_usage/compiler_flags.html>Compiler Flags</a></li><li><a href=/documentation/basic_usage/running.html>Running</a></li><li><a href=/documentation/basic_usage/acknowledging_epoch.html>Acknowledging EPOCH</a></li><li><a href=/documentation/basic_usage/libraries.html>Libraries</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/input_deck/input_deck.html>Input deck</a><ul class="nav docs-sidenav"><li><a href=/documentation/input_deck/input_deck_antenna.html>Antenna block</a></li><li><a href=/documentation/input_deck/input_deck_boundaries.html>Boundaries block</a></li><li><a href=/documentation/input_deck/input_deck_bremsstrahlung.html>Bremsstrahlung block</a></li><li><a href=/documentation/input_deck/input_deck_collisions.html>Collisions block</a></li><li><a href=/documentation/input_deck/input_deck_constant.html>Constant block</a></li><li><a href=/documentation/input_deck/input_deck_control.html>Control block</a></li><li><a href=/documentation/input_deck/input_deck_dist_fn.html>Dist_fn block</a></li><li><a href=/documentation/input_deck/input_deck_fields.html>Fields block</a></li><li><a href=/documentation/input_deck/input_deck_injector.html>Injector block</a></li><li><a href=/documentation/input_deck/input_deck_laser.html>Laser block</a></li><li><a href=/documentation/input_deck/input_deck_output_block.html>Output block</a></li><li><a href=/documentation/input_deck/input_deck_output_global.html>Output_global block</a></li><li><a href=/documentation/input_deck/input_deck_particle_file.html>Particles_from_file block</a></li><li><a href=/documentation/input_deck/input_deck_probe.html>Probe block</a></li><li><a href=/documentation/input_deck/input_deck_qed.html>QED block</a></li><li><a href=/documentation/input_deck/input_deck_species.html>Species block</a></li><li class=active><a href=/documentation/input_deck/input_deck_subset.html>Subset block</a></li><li><a href=/documentation/input_deck/input_deck_window.html>Window block</a></li><li><a href=/documentation/input_deck/binary_files.html>Binary files</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/code_details.html>Code details</a><ul class="nav docs-sidenav"><li><a href=/documentation/code_details/maths_parser.html>Maths parser</a></li><li><a href=/documentation/code_details/using_epoch_in_practice.html>Using EPOCH in practice</a></li><li><a href=/documentation/code_details/using_delta_f.html>Using delta f</a></li><li><a href=/documentation/code_details/previous_versions.html>Previous versions</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/visualising_output.html>Visualising output</a><ul class="nav docs-sidenav"><li><a href=/documentation/visualising_output/visualising_sdf_files_with_idl_or_gdl.html>IDL or GDL</a></li><li><a href=/documentation/visualising_output/visualising_sdf_files_with_llnl_visit.html>LLNL VisIt</a></li><li><a href=/documentation/visualising_output/python.html>Python</a></li><li><a href=/documentation/visualising_output/python_beam.html>Python BEAM</a></li><li><a href=/documentation/visualising_output/python_sdf_helper.html>Python sdf_helper</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/documentation/examples.html>Examples</a><ul class="nav docs-sidenav"><li><a href=/documentation/examples/basic_examples.html>Basic examples</a></li><li><a href=/documentation/examples/workshop_examples.html>Workshop examples</a></li><li><a href=/documentation/examples/workshop_examples_continued.html>Workshop examples continued</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><ul><li><a href=#subsets_of_fields>Subsets of fields</a></li><li><a href=#persistent_subsets>Persistent subsets</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><article class=article><div class=docs-article-container><h1>Subset block</h1><div class=article-style><p>This block contains configuration for filters which can be used to
modify the data to be output. See
<a href=/documentation/input_deck/input_deck>EPOCH input
deck</a> for more information on the input
deck.</p><p>It is possible to restrict the number of particles written to file
according to various criteria. For example, you can now output the
momentum of all particles which have a gamma lower than 1.8 or the
positions of a randomly chosen subset of a given species.</p><p>A new input deck block named &ldquo;subset&rdquo; is defined which accepts the
following parameters:</p><ul><li><code>name</code> - The name given to this subset. This is used to
identify the subset in the output block and is also used when labelling
the data in the SDF files.</li><li><code>include_species</code> - Add the given particle species to the
set of particles that this subset applies to. By default, no particle
species are included.</li><li><code>dumpmask</code> - The dumpmask to use when considering this
subset in an output block. This takes the same form as the output block
dumpmask. The default value is &ldquo;always&rdquo;.</li><li><code>random_fraction</code> - Select a random percentage of the
particle species. This is a real value between zero and one. If 0 is
specified, no particles are selected. If 1 is specified, all the
particles are selected. If 0.2 is specified, 20% of the particles are
selected.</li><li><code>{px,py,pz,weight,charge,mass,gamma}_min</code> - Select only
the particles with momentum, weight, charge, mass or gamma which is
greater than the given value.</li><li><code>{px,py,pz,weight,charge,mass,gamma}_max</code> - Select only
the particles with momentum, weight, charge, mass or gamma which is less
than the given value.</li><li><code>{x,y,z}_min</code> - Select only the particles whose position
lies above the given value.</li><li><code>{x,y,z}_max</code> - Select only the particles whose position
lies below the given value.</li><li><code>id_min,max</code> - Select only the particles whose &ldquo;id&rdquo; is
greater than or less than the given values. The &ldquo;id&rdquo; field is explained
below.</li><li><code>skip,skip_{x,y,z}</code> - Integer parameter for subsampling
output. If set to a positive integer then all grid-based variables using
the subset restriction will be reduced when being written to file. This
is achieved by skipping by the specified number of cells in each of the
specified directions. The &ldquo;skip&rdquo; parameter provides a quick method for
setting the same number of cells to skip in all directions. This
currently only applies to grid-based variables and is ignored for data
averages. The default value is &ldquo;0&rdquo;.</li></ul><p>Once a subset has been defined, the subset name can then be used in
place of (or in addition to) the dumpmask in an &ldquo;output&rdquo; block (see also
<a href=/documentation/input_deck/input_deck_output_block#dumpmask>here</a>). For example:</p><pre><code class=language-perl>begin:subset
   name = background
   random_fraction = 0.1
   include_species:electron
   include_species:proton
end:subset

begin:subset
   name = high_gamma
   gamma_min = 1.3
   include_species:electron
end:subset

begin:output
   particles = background + high_gamma + always
   px = background + high_gamma
   py = background
   pz = always
end:output
</code></pre><p>In this example, three &ldquo;px&rdquo; blocks will be written:
&ldquo;Particles/background/electron/Px&rdquo;, &ldquo;Particles/background/proton/Px&rdquo; and
&ldquo;Particles/high_gamma/electron/Px&rdquo;. The &ldquo;background&rdquo; blocks will
contain 10% of the each species, randomly selected. The &ldquo;high_gamma&rdquo;
block will contain all the electrons with a gamma greater than 1.3.</p><p>There will also be &ldquo;Particles/background/electron/Py&rdquo; and
&ldquo;Particles/background/proton/Py&rdquo; block containing y-momentum for the
same 10% random subset of particles. Finally, the
&ldquo;Particles/All/electron/Pz&rdquo; and &ldquo;Particles/All/proton/Pz&rdquo; will contain
the z-momentum for all particles.</p><p>The final selection criteria given in the list above is &ldquo;id_min&rdquo; and
&ldquo;id_max&rdquo;. As of EPOCH version 4.0, the code can now assign a unique ID
field to every particle in the simulation. This can be useful for
tracking specific particles as they move through a simulation. As this
field adds extra memory requirements to the particles, it is disabled by
default and must be compiled in using the <strong><code>-DPARTICLE_ID</code></strong> compiler
flag.</p><p>Particle IDs can be written to file using the &ldquo;id&rdquo; variable name in the
<a href=/documentation/input_deck/input_deck_output_block>&ldquo;output&rdquo;</a> block. Eg.</p><pre><code class=language-perl>begin:output
   particles = always
   id = always
end:output
</code></pre><h3 id=subsets_of_fields>Subsets of fields</h3><p>Subset blocks can be applied to per-species variables such as current
and temperature. Only particles within the given momentum ranges and of
the selected species are included in the calculations. In addition,
subset blocks can now be applied to field or grid variables. This allows
you to output spatial sections using the <code>{x,y,z}_max,min</code>
restrictions. The output data will be trimmed to the selected ranges and
a corresponding restricted grid included in the output. Note that
specifying an empty range will lead to output of the entire domain. For
example, the following snippet will output an ex_c_centre variable
restricted to the centre 1/3rd of the domain with a corresponding grid
grid_centre:</p><pre><code class=language-perl>begin:subset
   name = centre
   x_min = x_min + (x_max - x_min) / 3.0
   x_max = x_min + 2.0 * (x_max - x_min) / 3.0
end:subset

begin:output 
   ...
   ex = always + centre
end:output
</code></pre><h3 id=persistent_subsets>Persistent subsets</h3><p>Persistent subsets are subsets that capture a set of particles once,
given a specified set of parameters, and then track those particles
permanently. Persistent subsets use the same blocks as normal subsets
and take the same parameters as normal subsets (except the skip
parameters which only apply to fields). Subsets are marked as persistent
by setting either</p><ul><li><code>persist_start_time</code> - Time at which to record the list
of particles to be tracked. Throughout the rest of the simulation
this recorded list will be used whenever requesting output for this
subset. &ldquo;persist_after_time&rdquo; is accepted as an alias. Set to 0
to record from the start of the simulation.</li><li><code>persist_start_step</code> - Similar to persist_start_time
except this specifies a simulation step number to use instead of
time. &ldquo;persist_after_step&rdquo; is accepted as an alias.</li></ul><p>If the input deck is edited on restart to add a new persistent subset
then it must be added <strong>after</strong> existing persistent subsets or problems
may occur on restart.</p></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/documentation/input_deck/input_deck_qed.html rel=next>QED block</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=/documentation/input_deck/input_deck_constant.html rel=prev>Constant block</a></div></div></div></div><div class=body-footer><p>Last updated on Apr 6, 2023</p></div></article><footer class=site-footer><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.</p></footer></main></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script><script>const code_highlighting=!0</script><script>const isSiteThemeDark=!1</script><script>const search_config={indexURI:"/index.json",minLength:1,threshold:.3},i18n={no_results:"No results found",placeholder:"Search...",results:"results found"},content_type={post:"Posts",project:"Projects",publication:"Publications",talk:"Talks"}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.6f1005d1a84220e2f466ff3d8e712f31.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div></body></html>